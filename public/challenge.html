<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å•è¯é—¯å…³</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    #game { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; }
    #question { font-size: 24px; margin-bottom: 20px; }
    #answer { width: 100%; padding: 10px; font-size: 18px; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    #result { margin-top: 20px; font-size: 18px; }
    #progress { margin-top: 10px; font-size: 14px; }
  </style>
</head>
<body>
  <div id="game">
    <h2>å•è¯é—¯å…³æ¨¡å¼</h2>

    <!-- æ¨¡å¼é€‰æ‹© -->
    <div>
      <label><input type="radio" name="mode" value="en-zh" checked> è‹±è¯‘ä¸­</label>
      <label><input type="radio" name="mode" value="zh-en"> ä¸­è¯‘è‹±</label>
    </div>

    <div id="question">ç‚¹å‡»å¼€å§‹ç”Ÿæˆé¢˜ç›®</div>
    <input type="text" id="answer" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ">
    <button onclick="checkAnswer()">æäº¤ç­”æ¡ˆ</button>
    <button onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>

    <div id="result"></div>
    <div id="progress"></div>
  </div>

  <script>
    // ======= ç¤ºä¾‹å•è¯ï¼ˆè¿™é‡Œæ›¿æ¢æˆ 5000 é«˜é¢‘è¯è¡¨ï¼‰=======
    const words = [
      "abandon", "ability", "able", "about", "above", "accept", "according", "account", "across", "act",
      "action", "activity", "actually", "add", "address", "administration", "admit", "adult", "affect", "after",
      "again", "against", "age", "agency", "agent", "ago", "agree", "agreement", "ahead", "air"
      // TODO: åœ¨è¿™é‡Œæ’å…¥å®Œæ•´çš„5000è¯è¡¨
    ];

    let currentIndex = 0;
    const wordsPerLevel = 100; // æ¯å…³100è¯

    async function prepareQuestion() {
      const word = words[currentIndex];
      const mode = document.querySelector("input[name='mode']:checked").value;

      let questionText, correctAnswer;

      try {
        if (mode === "en-zh") {
          // è‹±è¯‘ä¸­
          questionText = word;
          const res = await fetch(`/api/baiduTranslate?word=${encodeURIComponent(word)}`);
          if (!res.ok) throw new Error(`HTTP é”™è¯¯ï¼š${res.status}`);

          let data;
          try {
            data = await res.json();
          } catch (e) {
            const text = await res.text();
            console.error("âš ï¸ API è¿”å›çš„ä¸æ˜¯ JSONï¼Œå®é™…å†…å®¹ï¼š", text);
            throw e;
          }

          if (!data.trans_result || data.trans_result.length === 0) {
            throw new Error("ç™¾åº¦ç¿»è¯‘è¿”å›ç»“æœä¸ºç©º");
          }

          correctAnswer = data.trans_result[0].dst;

        } else {
          // ä¸­è¯‘è‹±
          const res = await fetch(`/api/baiduTranslate?word=${encodeURIComponent(word)}`);
          if (!res.ok) throw new Error(`HTTP é”™è¯¯ï¼š${res.status}`);

          let data;
          try {
            data = await res.json();
          } catch (e) {
            const text = await res.text();
            console.error("âš ï¸ API è¿”å›çš„ä¸æ˜¯ JSONï¼Œå®é™…å†…å®¹ï¼š", text);
            throw e;
          }

          if (!data.trans_result || data.trans_result.length === 0) {
            throw new Error("ç™¾åº¦ç¿»è¯‘è¿”å›ç»“æœä¸ºç©º");
          }

          questionText = data.trans_result[0].dst;
          correctAnswer = word;
        }

        // æ›´æ–°é¡µé¢
        document.getElementById("question").innerText = questionText;
        document.getElementById("answer").value = "";
        document.getElementById("answer").dataset.correct = correctAnswer;
        document.getElementById("progress").innerText =
          `ç¬¬ ${currentIndex + 1} / ${words.length} è¯ | å½“å‰ç¬¬ ${Math.floor(currentIndex / wordsPerLevel) + 1} å…³`;

      } catch (err) {
        console.error("âŒ prepareQuestion å‡ºé”™ï¼š", err);
        document.getElementById("question").innerText = "åŠ è½½é¢˜ç›®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—";
      }
    }

    function checkAnswer() {
      const userAnswer = document.getElementById("answer").value.trim();
      const correctAnswer = document.getElementById("answer").dataset.correct;

      if (userAnswer === "") {
        document.getElementById("result").innerText = "âš ï¸ è¯·è¾“å…¥ç­”æ¡ˆ";
        return;
      }

      if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
        document.getElementById("result").innerText = "âœ… æ­£ç¡®ï¼";
      } else {
        document.getElementById("result").innerText = `âŒ é”™è¯¯ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
      }
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex >= words.length) {
        document.getElementById("question").innerText = "ğŸ‰ æ­å–œå®Œæˆæ‰€æœ‰å•è¯ï¼";
        document.getElementById("progress").innerText = "";
        return;
      }
      prepareQuestion();
    }

    // åˆå§‹åŠ è½½ç¬¬ä¸€é¢˜
    prepareQuestion();
  </script>
</body>
</html>
