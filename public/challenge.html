<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>单词噩梦 - 闯关模式</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <header class="p-4 bg-blue-600 text-white text-center">
    <h1 class="text-2xl font-bold">5000 单词闯关</h1>
  </header>

  <main class="max-w-xl mx-auto p-6">
    <div class="mb-4">
      <label class="mr-4"><input type="radio" name="mode" value="en-zh" checked /> 英译中</label>
      <label><input type="radio" name="mode" value="zh-en" /> 中译英</label>
    </div>

    <div id="questionBox" class="bg-white p-6 rounded-lg shadow text-center">
      <p id="question" class="text-2xl font-semibold mb-4">加载中...</p>
      <input id="answer" type="text" placeholder="请输入答案"
        class="w-full p-3 border rounded-lg mb-4" />
      <button onclick="checkAnswer()" class="px-6 py-3 bg-green-500 text-white rounded-lg shadow hover:bg-green-600">
        提交
      </button>
    </div>

    <p id="feedback" class="mt-4 text-lg font-medium"></p>
  </main>

  <script>
    const words = ["apple","banana","computer","university","knowledge","success","dream","challenge"]; 
    let currentIndex = 0;

    async function prepareQuestion() {
      const word = words[currentIndex];
      const mode = document.querySelector("input[name='mode']:checked").value;
      let questionText, correctAnswer;

      try {
        const res = await fetch(`/api/baiduTranslate?word=${encodeURIComponent(word)}`);
        const data = await res.json();

        if (mode === "en-zh") {
          questionText = word;
          correctAnswer = data.trans_result?.[0]?.dst || "";
        } else {
          questionText = data.trans_result?.[0]?.dst || "";
          correctAnswer = word;
        }

        document.getElementById("question").innerText = questionText;
        document.getElementById("answer").dataset.correct = correctAnswer;
      } catch (err) {
        console.error("prepareQuestion error:", err);
        document.getElementById("question").innerText = "❌ 加载题目失败";
      }
    }

    function checkAnswer() {
      const input = document.getElementById("answer");
      const correct = input.dataset.correct;
      const userAnswer = input.value.trim();

      if (userAnswer === correct) {
        document.getElementById("feedback").innerText = "✅ 正确!";
      } else {
        document.getElementById("feedback").innerText = `❌ 错误，正确答案是：${correct}`;
      }

      currentIndex = (currentIndex + 1) % words.length;
      input.value = "";
      setTimeout(prepareQuestion, 1500);
    }

    prepareQuestion();
  </script>
</body>
</html>
