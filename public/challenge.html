<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å•è¯å™©æ¢¦ - é—¯å…³æ¨¡å¼</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start p-6">

  <h1 class="text-3xl font-bold text-blue-600 mb-6">å•è¯å™©æ¢¦ - é—¯å…³æ¨¡å¼</h1>

  <!-- æ¨¡å¼åˆ‡æ¢ -->
  <div class="mb-4 space-x-2">
    <button onclick="setMode('en2zh')" class="px-4 py-2 bg-blue-500 text-white rounded">è‹±è¯‘ä¸­</button>
    <button onclick="setMode('zh2en')" class="px-4 py-2 bg-green-500 text-white rounded">ä¸­è¯‘è‹±</button>
  </div>

  <!-- å‡ºé¢˜æ¡† -->
  <div id="wordBox" class="bg-white shadow rounded p-6 w-full max-w-lg text-center">
    <p>æ­£åœ¨åŠ è½½é¢˜ç›®...</p>
  </div>

  <script>
  let words = [];
  let currentIndex = 0;
  let currentLevel = 1;
  let mode = "en2zh"; // é»˜è®¤è‹±è¯‘ä¸­
  let wrongList = JSON.parse(localStorage.getItem("wrongList")) || [];

  // åŠ è½½å•è¯
  async function loadWords() {
    try {
      const res = await fetch("words.json");
      const data = await res.json();
      const levelData = data.levels.find(l => l.level === currentLevel);
      words = levelData.words;
      showWord();
    } catch (err) {
      document.getElementById("wordBox").innerHTML = "<p class='text-red-500'>é¢˜ç›®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ words.json</p>";
      console.error("åŠ è½½å•è¯é”™è¯¯:", err);
    }
  }

  // æ˜¾ç¤ºé¢˜ç›®
  function showWord() {
    if (currentIndex >= words.length) {
      document.getElementById("wordBox").innerHTML = `<p>ğŸ‰ ç¬¬ ${currentLevel} å…³å®Œæˆï¼</p>`;
      return;
    }

    let word = words[currentIndex];
    let questionText = (mode === "en2zh") ? word.en : word.zh;
    document.getElementById("wordBox").innerHTML = `
      <p class="mb-2">ç¬¬ ${currentLevel} å…³ ${currentIndex + 1}/${words.length}</p>
      <p class="text-xl font-semibold mb-4">${questionText}</p>
      <input id="answer" type="text" placeholder="è¯·è¾“å…¥ç­”æ¡ˆ" class="border px-3 py-2 rounded w-2/3" />
      <div class="mt-4 space-x-2">
        <button onclick="checkAnswer()" class="px-4 py-2 bg-blue-500 text-white rounded">æäº¤</button>
        <button onclick="skip()" class="px-4 py-2 bg-gray-400 text-white rounded">è·³è¿‡</button>
      </div>
      <p id="feedback" class="mt-3"></p>
    `;
  }

  // æ£€æŸ¥ç­”æ¡ˆ
  function checkAnswer() {
    let word = words[currentIndex];
    let userAns = document.getElementById("answer").value.trim();
    let correct = (mode === "en2zh") ? word.zh : word.en;

    if (userAns === correct) {
      document.getElementById("feedback").innerHTML = `<span class="text-green-600 font-bold">âœ” æ­£ç¡®</span>`;
    } else {
      document.getElementById("feedback").innerHTML = `<span class="text-red-600 font-bold">âœ˜ é”™è¯¯ï¼Œæ­£ç¡®ç­”æ¡ˆï¼š${correct}</span>`;

      // ä¿å­˜é”™é¢˜
      wrongList.push({
        en: word.en,
        zh: word.zh,
        yourAnswer: userAns
      });
      localStorage.setItem("wrongList", JSON.stringify(wrongList));
    }

    currentIndex++;
    setTimeout(showWord, 1000);
  }

  // è·³è¿‡
  function skip() {
    currentIndex++;
    showWord();
  }

  // åˆ‡æ¢æ¨¡å¼
  function setMode(m) {
    mode = m;
    currentIndex = 0;
    showWord();
  }

  window.onload = loadWords;
  </script>
</body>
</html>
