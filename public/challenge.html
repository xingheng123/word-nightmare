<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>单词噩梦 - 闯关模式</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start p-6">

  <h1 class="text-3xl font-bold text-blue-600 mb-6">单词噩梦 - 闯关模式</h1>

  <!-- 模式切换 -->
  <div class="mb-4 space-x-2">
    <button onclick="setMode('en2zh')" class="px-4 py-2 bg-blue-500 text-white rounded">英译中</button>
    <button onclick="setMode('zh2en')" class="px-4 py-2 bg-green-500 text-white rounded">中译英</button>
  </div>

  <!-- 出题框 -->
  <div id="wordBox" class="bg-white shadow rounded p-6 w-full max-w-lg text-center">
    <p>正在加载题目...</p>
  </div>

  <script>
  let words = [];
  let currentIndex = 0;
  let currentLevel = 1;
  let mode = "en2zh"; // 默认英译中
  let wrongList = JSON.parse(localStorage.getItem("wrongList")) || [];

  // 加载单词
  async function loadWords() {
    try {
      const res = await fetch("words.json");
      const data = await res.json();
      const levelData = data.levels.find(l => l.level === currentLevel);
      words = levelData.words;
      showWord();
    } catch (err) {
      document.getElementById("wordBox").innerHTML = "<p class='text-red-500'>题目加载失败，请检查 words.json</p>";
      console.error("加载单词错误:", err);
    }
  }

  // 显示题目
  function showWord() {
    if (currentIndex >= words.length) {
      document.getElementById("wordBox").innerHTML = `<p>🎉 第 ${currentLevel} 关完成！</p>`;
      return;
    }

    let word = words[currentIndex];
    let questionText = (mode === "en2zh") ? word.en : word.zh;
    document.getElementById("wordBox").innerHTML = `
      <p class="mb-2">第 ${currentLevel} 关 ${currentIndex + 1}/${words.length}</p>
      <p class="text-xl font-semibold mb-4">${questionText}</p>
      <input id="answer" type="text" placeholder="请输入答案" class="border px-3 py-2 rounded w-2/3" />
      <div class="mt-4 space-x-2">
        <button onclick="checkAnswer()" class="px-4 py-2 bg-blue-500 text-white rounded">提交</button>
        <button onclick="skip()" class="px-4 py-2 bg-gray-400 text-white rounded">跳过</button>
      </div>
      <p id="feedback" class="mt-3"></p>
    `;
  }

  // 检查答案
  function checkAnswer() {
    let word = words[currentIndex];
    let userAns = document.getElementById("answer").value.trim();
    let correct = (mode === "en2zh") ? word.zh : word.en;

    if (userAns === correct) {
      document.getElementById("feedback").innerHTML = `<span class="text-green-600 font-bold">✔ 正确</span>`;
    } else {
      document.getElementById("feedback").innerHTML = `<span class="text-red-600 font-bold">✘ 错误，正确答案：${correct}</span>`;

      // 保存错题
      wrongList.push({
        en: word.en,
        zh: word.zh,
        yourAnswer: userAns
      });
      localStorage.setItem("wrongList", JSON.stringify(wrongList));
    }

    currentIndex++;
    setTimeout(showWord, 1000);
  }

  // 跳过
  function skip() {
    currentIndex++;
    showWord();
  }

  // 切换模式
  function setMode(m) {
    mode = m;
    currentIndex = 0;
    showWord();
  }

  window.onload = loadWords;
  </script>
</body>
</html>
