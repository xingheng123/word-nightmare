<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>单词噩梦 ‐ 闯关模式</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900 flex flex-col items-center justify-center min-h-screen">

  <div class="bg-white shadow-md rounded p-6 w-full max-w-md">
    <h1 class="text-2xl font-bold mb-6">🚀 闯关模式（每关 100 个单词）</h1>
    <div id="question" class="text-xl font-semibold mb-4">加载中...</div>
    <input id="answer" type="text" placeholder="请输入英文单词的中文意思" 
           class="w-full border rounded px-3 py-2 mb-4" />
    <button onclick="checkAnswer()" class="w-full bg-green-500 text-white px-4 py-2 rounded mb-4">
      提交
    </button>
    <div id="feedback" class="text-lg mb-4"></div>
    <a href="index.html" class="underline text-blue-600">返回首页</a>
  </div>

  <script>
    let wordsByLevel = {};
    let currentLevel = 1;
    let currentList = [];
    let currentIndex = 0;

    async function loadWords() {
      try {
        const resp = await fetch('words.json');
        wordsByLevel = await resp.json();
        currentList = wordsByLevel["level1"];
        currentIndex = 0;
        loadQuestion();
      } catch(e) {
        document.getElementById('question').innerText = '载入词库失败';
      }
    }

    function loadQuestion() {
      if (currentIndex >= currentList.length) {
        currentLevel++;
        const nextKey = "level" + currentLevel;
        if (wordsByLevel[nextKey]) {
          currentList = wordsByLevel[nextKey];
          currentIndex = 0;
          alert(`第 ${currentLevel-1} 关完成！进入第 ${currentLevel} 关`);
        } else {
          document.getElementById('question').innerText = "🎉 全部关卡完成！";
          document.getElementById('answer').style.display = "none";
          return;
        }
      }
      document.getElementById('question').innerText = `第 ${currentLevel} 关 ‐ 请翻译：${currentList[currentIndex]}`;
      document.getElementById('answer').value = '';
      document.getElementById('feedback').innerText = '';
    }

    function checkAnswer() {
      const user = document.getElementById('answer').value.trim();
      const correct = currentList[currentIndex];
      if (user.toLowerCase() === correct.toLowerCase()) {
        document.getElementById('feedback').innerText = "✅ 正确！";
      } else {
        document.getElementById('feedback').innerText = `❌ 错误，答案是：${correct}`;
        saveWrong(correct);
      }
      currentIndex++;
      setTimeout(loadQuestion, 800);
    }

    function saveWrong(word) {
      const key = 'wrongs';
      let arr = JSON.parse(localStorage.getItem(key) || '[]');
      if (!arr.includes(word)) {
        arr.push(word);
        localStorage.setItem(key, JSON.stringify(arr));
      }
    }

    window.addEventListener('load', loadWords);
  </script>

</body>
</html>
